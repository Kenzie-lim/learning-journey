## Overview

### Context
Builds on yesterday's VM/SSH fundamentals. This lab applies the same infrastructure skills (SSH, Linux commands) to a GPU-intensive ML workload. Introduces the image generation ecosystem: checkpoints, LoRAs, and community model sharing.

### Objective
Deploy Stable Diffusion WebUI Forge on Azure ML Compute Instance, generate images using community models, and set up cloud storage sync for outputs.

---

## Lab/Lecture Flow

**1. SSH into Azure ML Compute Instance**
- What: Connected via `ssh -i key.pem azureuser@IP -p 50000`
- **Why**: ML Compute Instance uses port 50000 (not 22), requires key-based auth
- **So what**: Same SSH pattern as yesterday, but different VM image (pre-installed conda, CUDA, GPU drivers)

**2. Install Stable Diffusion WebUI Forge**
- What: `git clone` + `conda create -n sd python=3.10` + `./webui.sh --share`
- **Why**: WebUI provides GUI for SD; Forge is optimized fork with better memory management
- **So what**: Separates "model/engine" from "interface" — SD itself is just code, WebUI makes it usable

**3. Download Base Model (Hugging Face)**
- What: Downloaded `sd-v1-5.safetensors` (7GB) and `flux1-dev-fp8.safetensors` (17GB)
- **Why**: Base models (checkpoints) are foundation for image generation
- **So what**: Different models = different capabilities (SD 1.5 vs Flux quality/style)

**4. CivitAI Setup + LoRA Download**
- What: Created account, got API key, used `civitdl 1856022 . -k API_KEY`
- **Why**: CivitAI = community model marketplace; LoRAs add styles on top of base models
- **So what**: LoRA must match base model (Flux.1 D LoRA needs Flux Dev checkpoint, not Schnell)

**5. Image Generation with Prompts**
- What: Generated VHS-style images using `<lora:90s-vhs:1> VHS90s, [description]`
- **Why**: Trigger words activate LoRA; emphasis syntax `(subject:1.5)` increases weight
- **So what**: Prompt engineering matters — surreal subjects (shark walking) need explicit emphasis

**6. Output Retrieval (scp)**
- What: `scp -i key.pem -P 50000 -r user@IP:~/outputs/ local_path/`
- **Why**: Manual file transfer from VM to local PC
- **So what**: Same key/port as SSH; `-r` for recursive folder copy

**7. Azure Blob Storage + AzCopy Sync**
- What: Created storage container, generated SAS token, ran `azcopy sync outputs "blob_url"`
- **Why**: Automated cloud backup vs manual scp
- **So what**: SAS URL = storage account + container name + access token; sync uploads new files only

---

## Key Insight
The technical barrier to image generation is surprisingly low — CivitAI democratizes access to fine-tuned models. The real challenge is understanding model compatibility (which LoRA works with which checkpoint) and prompt engineering for non-realistic outputs.

---

## Deep Dive

- **Base Model Compatibility**: LoRAs are trained on specific base models (SD 1.5, SDXL, Flux.1 D/S). Mismatched pairing produces errors or garbage output. CivitAI shows "Base Model" field — must check before download.

- **Flux.1 D vs S**: Dev (D) = high quality, 20-50 steps, slower. Schnell (S) = fast, 4 steps, lower quality. Different LoRAs target different versions.

- **Prompt Emphasis Syntax**: `(subject:1.5)` increases attention weight. Useful for surreal/impossible subjects that models resist generating (anthropomorphic animals, fantasy scenes).

- **CivitAI Creator Economy**: Most creators earn little/nothing. Top 1% monetize via Creator Program (download-based revenue), early access tiers, or Patreon. NSFW content dominates demand — follows historical pattern of new media adoption.

- **Gradio Tunneling**: `--share` creates temporary public URL (72hr expiry) via Gradio's relay service. VM's localhost:7860 is inaccessible externally; tunnel bridges that gap.
